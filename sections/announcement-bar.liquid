<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"
/>

<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css"
/>

{% if section.blocks.size > 0 %}

<!-- ================= STYLES ================= -->
<style>
  .announcement-slider {
    opacity: 0;
    visibility: hidden;
  }

  .announcement-slider.slick-initialized {
    opacity: 1;
    visibility: visible;
  }

  .announcement-slide {
    background-color: {{ section.settings.color_bg }};
    padding: 10px 0;
    color: {{ section.settings.color_text }};
    font-size: {{ section.settings.font_size }}px;
    text-align: center;
    font-weight: 600;
  }

  .announcement-slide a {
    color: {{ section.settings.color_text }};
    text-decoration: none;
  }

  .announcement-slide a:hover {
    color: {{ section.settings.color_text_hover }};
  }

  @media screen and (max-width: 991px) {
    .announcement-slide {
      font-size: 12px;
    }
  }
</style>

<!-- ================= HTML ================= -->
<div class="announcement-slider js-announcement-slick-{{ section.id }}">
  {% for block in section.blocks %}
    <div class="announcement-slide">
      {% if block.settings.link != blank %}
        <a href="{{ block.settings.link }}">{{ block.settings.text }}</a>
      {% else %}
        {{ block.settings.text }}
      {% endif %}
    </div>
  {% endfor %}
</div>
<script
  src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"
  defer
></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- ================= SCRIPT ================= -->
<script>
(function () {

  function initAnnouncementSlider() {
    var $slider = $('.js-announcement-slick-{{ section.id }}');

    if (!$slider.length) return;

    // Prevent multiple initializations (FIXES CRASH)
    if ($slider.hasClass('slick-initialized')) {
      $slider.slick('unslick');
    }

    $slider.on('init', function () {
      $slider.addClass('slick-initialized');
    });

    $slider.slick({
      infinite: true,
      autoplay: true,
      autoplaySpeed: 2000,
      arrows: false,
      dots: false,
      speed: 500,
      slidesToShow: 1,
      slidesToScroll: 1,
      pauseOnHover: false,
      pauseOnFocus: false,
      adaptiveHeight: false
    });
  }

  // Normal page load
  document.addEventListener('DOMContentLoaded', initAnnouncementSlider);

  // Shopify section reload (Theme Editor support)
  document.addEventListener('shopify:section:load', function (event) {
    if (event.target.querySelector('.js-announcement-slick-{{ section.id }}')) {
      initAnnouncementSlider();
    }
  });

})();
</script>

{% endif %}

{% schema %}
{
  "name": "Announcement Bar (Slider)",
  "settings": [
    {
      "type": "range",
      "id": "header_padding",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Header padding",
      "default": 0
    },
    {
      "type": "color",
      "id": "color_bg",
      "label": "Background color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "color_text",
      "label": "Text color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "color_text_hover",
      "label": "Hover color",
      "default": "#eeeeee"
    },
    {
      "type": "range",
      "id": "font_size",
      "min": 10,
      "max": 40,
      "step": 1,
      "unit": "px",
      "label": "Font size",
      "default": 14
    }
  ],

  "blocks": [
    {
      "type": "announcement",
      "name": "Announcement",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Announcement text",
          "default": "This is an example announcement"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link (optional)"
        }
      ]
    }
  ],

  "max_blocks": 12,

  "presets": [
    {
      "name": "Announcement Bar Slider",
      "category": "Header"
    }
  ]
}
{% endschema %}
